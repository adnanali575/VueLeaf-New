import{d as N,k as m,I as V,J as G,o as M,c as i,b as e,a as d,p as x,e as u,h as b,D as f,ae as w,af as k,F as _,r as T,t as l,aY as j,g as c,ah as E,ao as $,ap as z}from"./main-Dr4KW1PH.js";import{F as P}from"./filter-lOc3pAsw.js";const B={class:"flex-1 p-6"},K={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},W={class:"flex justify-between items-center mb-8"},H=["disabled"],J={class:"bg-white rounded-lg shadow-sm mb-8"},Y={class:"p-4 space-y-4"},q={class:"grid grid-cols-5 gap-4"},Q={class:"relative"},X={class:"relative"},Z={class:"relative"},ee={class:"relative"},te=["value"],se={class:"relative"},ae=["value"],oe={class:"bg-white rounded-lg shadow overflow-hidden"},ne={class:"overflow-x-auto"},le={class:"min-w-full divide-y divide-gray-200"},re={class:"bg-white divide-y divide-gray-200"},ie={key:0},de={colspan:"4",class:"px-6 py-4 text-center text-base text-gray-600"},ue={class:"flex items-center justify-center space-x-2"},ce={key:1},ge={class:"w-48 px-8 py-4 whitespace-nowrap text-base text-gray-600"},pe={class:"w-40 px-8 py-4 whitespace-nowrap"},ve={class:"text-base font-medium text-gray-700"},me={class:"w-32 px-8 py-4 whitespace-nowrap"},fe={class:"px-8 py-4"},ye={class:"group relative"},xe={class:"text-base text-gray-600"},he={class:"hidden group-hover:block absolute left-0 top-full mt-2 p-3 bg-gray-800 text-white text-sm rounded-lg shadow-lg z-10 w-96"},be={class:"space-y-1"},we={class:"border-t border-gray-200 px-4 py-3 flex items-center justify-between"},_e={class:"text-sm text-gray-500"},Te={class:"flex items-center gap-2"},Pe=["disabled"],ke={class:"text-sm text-gray-600"},Ee=["disabled"],O=10,Ae=N({__name:"ActivityLogView",setup(Oe){const g=m([]),p=m(!1),r=m(1),y=m(1),o=m({method:"",actionType:"",username:"",dateRange:{start:"",end:""}}),U=V(()=>{var a;return((a=g.value)==null?void 0:a.length)||0}),L=[{value:"",label:"All Methods"},{value:"GET",label:"GET"},{value:"POST",label:"POST"},{value:"PUT",label:"PUT"},{value:"DELETE",label:"DELETE"}],A=[{value:"",label:"All Actions"},{value:"keyword",label:"Keyword Operations"},{value:"profile",label:"Profile Updates"},{value:"auth",label:"Authentication"},{value:"system",label:"System Access"}];function C(){o.value={method:"",actionType:"",username:"",dateRange:{start:"",end:""}}}async function v(a=1){p.value=!0;try{const t=await j.get("/admin/log",{params:{page:a,page_size:O,method:o.value.method,action_type:o.value.actionType,username:o.value.username,date_start:o.value.dateRange.start,date_end:o.value.dateRange.end}});g.value=t.data.results,y.value=Math.ceil(t.data.count/O),r.value=a}catch(t){console.error("Failed to fetch activities:",t)}finally{p.value=!1}}G(o,()=>{v(1)},{deep:!0});function h(a){const t={"Password change":"PASSWORD","Profile update":"PROFILE",Login:"LOGIN",Logout:"LOGOUT","Token refresh":"TOKEN"};for(const[n,I]of Object.entries(t))if(a.toLowerCase().includes(n.toLowerCase()))return{method:I,details:a};const s=["GET","POST","PUT","PATCH","DELETE"];for(const n of s)if(a.includes(n))return{method:n,details:a.replace(new RegExp(`^${n}\\s+`),"")};return{method:"ACTION",details:a}}function R(a){return{GET:"bg-blue-100 text-blue-800",POST:"bg-green-100 text-green-800",PUT:"bg-yellow-100 text-yellow-800",PATCH:"bg-yellow-100 text-yellow-800",DELETE:"bg-red-100 text-red-800",PASSWORD:"bg-purple-100 text-purple-800",PROFILE:"bg-indigo-100 text-indigo-800",LOGIN:"bg-teal-100 text-teal-800",LOGOUT:"bg-orange-100 text-orange-800",TOKEN:"bg-cyan-100 text-cyan-800"}[a]||"bg-gray-100 text-gray-800"}function S(a){const t=a.split(" | ")[0];return t.startsWith("/api/")?t.split("/").filter(n=>n&&n!=="api").map(n=>n.replace(/-/g," ")).map(n=>n.charAt(0).toUpperCase()+n.slice(1)).join(" - "):t}function D(a){const t=a.match(/User Agent: ([^|]+)/);return t?t[1].trim():"Unknown"}function F(a){const t=a.match(/IP: ([^|]+)/);return t?t[1].trim():"Unknown"}return M(()=>{v()}),(a,t)=>(c(),i("div",B,[e("div",K,[e("div",W,[t[9]||(t[9]=e("h1",{class:"text-xl md:text-2xl font-medium text-grey-700"},"User Activity Log",-1)),e("button",{onClick:t[0]||(t[0]=s=>v(r.value)),class:"inline-flex items-center px-4 py-2 text-base font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",disabled:p.value},[d(u(E),{class:x(["w-5 h-5 mr-2",{"animate-spin":p.value}])},null,8,["class"]),t[8]||(t[8]=b(" Refresh "))],8,H)]),e("div",J,[e("div",Y,[t[10]||(t[10]=e("div",null,[e("h2",{class:"text-lg font-medium text-gray-700"},"Activity Filters"),e("p",{class:"text-base text-gray-500"}," Filter activities by date range, method, and action type to focus your analysis. ")],-1)),e("div",q,[e("div",Q,[f(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>o.value.dateRange.start=s),type:"date",class:"w-full pl-3 pr-3 py-2 bg-white border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500"},null,512),[[w,o.value.dateRange.start]])]),e("div",X,[f(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>o.value.dateRange.end=s),type:"date",class:"w-full pl-3 pr-3 py-2 bg-white border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500"},null,512),[[w,o.value.dateRange.end]])]),e("div",Z,[d(u(P),{class:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-500 pointer-events-none"}),f(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>o.value.username=s),type:"text",placeholder:"Filter by username...",class:"w-full bg-white border border-gray-300 rounded-md pl-10 pr-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500"},null,512),[[w,o.value.username]])]),e("div",ee,[d(u(P),{class:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-500 pointer-events-none"}),f(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>o.value.method=s),class:"w-full bg-white border border-gray-300 rounded-md pl-10 pr-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 appearance-none"},[(c(),i(_,null,T(L,s=>e("option",{key:s.value,value:s.value},l(s.label),9,te)),64))],512),[[k,o.value.method]])]),e("div",se,[d(u(P),{class:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-500 pointer-events-none"}),f(e("select",{"onUpdate:modelValue":t[5]||(t[5]=s=>o.value.actionType=s),class:"w-full bg-white border border-gray-300 rounded-md pl-10 pr-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 appearance-none"},[(c(),i(_,null,T(A,s=>e("option",{key:s.value,value:s.value},l(s.label),9,ae)),64))],512),[[k,o.value.actionType]])])]),e("div",{class:"flex justify-end"},[e("button",{onClick:C,class:"text-sm font-medium text-gray-600 hover:text-gray-900"}," Clear Filters ")])])]),e("div",oe,[e("div",ne,[e("table",le,[t[15]||(t[15]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"w-48 px-8 py-4 text-left text-base font-medium text-gray-700 uppercase tracking-wider"},"Time"),e("th",{class:"w-40 px-8 py-4 text-left text-base font-medium text-gray-700 uppercase tracking-wider"},"User"),e("th",{class:"w-32 px-8 py-4 text-left text-base font-medium text-gray-700 uppercase tracking-wider"},"Method"),e("th",{class:"px-8 py-4 text-left text-base font-medium text-gray-700 uppercase tracking-wider"},"Details")])],-1)),e("tbody",re,[p.value&&!g.value.length?(c(),i("tr",ie,[e("td",de,[e("div",ue,[d(u(E),{class:"w-5 h-5 animate-spin"}),t[11]||(t[11]=e("span",null,"Loading activities...",-1))])])])):g.value.length?(c(!0),i(_,{key:2},T(g.value,s=>(c(),i("tr",{key:s.id,class:"hover:bg-gray-50"},[e("td",ge,l(new Date(s.action_time).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}).replace(","," -")),1),e("td",pe,[e("div",ve,l(s.user),1)]),e("td",me,[e("span",{class:x(["px-3 py-1 inline-flex text-sm font-normal rounded-md",R(h(s.change_message).method)])},l(h(s.change_message).method),3)]),e("td",fe,[e("div",ye,[e("div",xe,l(S(h(s.change_message).details)),1),e("div",he,[e("div",be,[e("div",null,[t[13]||(t[13]=e("span",{class:"font-medium"},"User Agent:",-1)),b(" "+l(D(s.change_message)),1)]),e("div",null,[t[14]||(t[14]=e("span",{class:"font-medium"},"IP:",-1)),b(" "+l(F(s.change_message)),1)])])])])])]))),128)):(c(),i("tr",ce,t[12]||(t[12]=[e("td",{colspan:"4",class:"px-6 py-4 text-center text-base text-gray-600"}," No activities found ",-1)])))])])]),e("div",we,[e("span",_e," Showing "+l(g.value.length)+" of "+l(U.value)+" activities ",1),e("div",Te,[e("button",{class:"p-1 rounded",disabled:r.value===1,onClick:t[6]||(t[6]=s=>v(r.value-1))},[d(u($),{class:x(["w-5 h-5",r.value===1?"text-gray-400":"text-gray-600"])},null,8,["class"])],8,Pe),e("span",ke,"Page "+l(r.value)+" of "+l(y.value),1),e("button",{class:"p-1 rounded",disabled:r.value===y.value,onClick:t[7]||(t[7]=s=>v(r.value+1))},[d(u(z),{class:x(["w-5 h-5",r.value===y.value?"text-gray-400":"text-gray-600"])},null,8,["class"])],8,Ee)])])])])]))}});export{Ae as default};
//# sourceMappingURL=ActivityLogView-CIepjrbh.js.map
