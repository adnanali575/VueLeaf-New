import{b6 as j,k as l,I as u,aY as f}from"./main-Dr4KW1PH.js";const K=j("analytics",()=>{const m=l([]),c=l([]),p=l(null),y=l(!1),w=l(null),g=l(null),i=l("idle"),v=l(null),r=l({dateRange:{start:new Date(new Date().setUTCHours(0,0,0,0)-30*24*60*60*1e3),end:new Date(new Date().setUTCHours(23,59,59,999))},platforms:[],visibleSentiments:{positive:!0,neutral:!0,negative:!0},timeFrame:"30d",minMentions:0,sortBy:"mentions"});u(()=>m.value?m.value.filter(a=>{const e=new Date(a.post_date);return!(e<r.value.dateRange.start||e>r.value.dateRange.end||r.value.platforms.length>0&&!r.value.platforms.includes(a.source))}):[]);const h=l([]),E=u(()=>h.value),F=l([]),R=l([]),k=u(()=>{if(!c.value||c.value.length===0)return[];const a=c.value.reduce((n,t)=>{if(!t.keyword_term||!t.source)return n;const s=new Date(t.post_date);if(s<r.value.dateRange.start||s>r.value.dateRange.end)return n;const o=`${t.keyword_term}|${t.source}`;n[o]||(n[o]={id:t.keyword_id,keyword:t.keyword_term,source:t.source,mentions:0,positive:0,neutral:0,negative:0});const d=n[o];return d.mentions++,t.sentiment&&d[t.sentiment]++,n},{});let e=Object.values(a).filter(n=>n.mentions>=r.value.minMentions);if(r.value.platforms.length===0){const n=e.reduce((t,s)=>{t[s.keyword]||(t[s.keyword]={id:s.id,keyword:s.keyword,mentions:0,positive:0,neutral:0,negative:0,source:"all"});const o=t[s.keyword];return o.mentions+=s.mentions,o.positive+=s.positive,o.neutral+=s.neutral,o.negative+=s.negative,t},{});e=Object.values(n)}else e=e.filter(n=>r.value.platforms.includes(n.source));return e.sort((n,t)=>{if(r.value.sortBy==="mentions")return t.mentions-n.mentions;if(r.value.sortBy==="sentiment"){const s=n.mentions>0?n.positive/n.mentions:0;return(t.mentions>0?t.positive/t.mentions:0)-s}else return t.mentions-n.mentions})}),H=u(()=>R.value),O=u(()=>k.value.map(e=>({keyword:e.keyword,positive:e.mentions>0?e.positive/e.mentions:0,neutral:e.mentions>0?e.neutral/e.mentions:0,negative:e.mentions>0?e.negative/e.mentions:0}))),P=u(()=>c.value?c.value.filter(a=>{const e=new Date(a.post_date);return e>=r.value.dateRange.start&&e<=r.value.dateRange.end}):[]),M=u(()=>{const a={positive:0,negative:0,neutral:0,total:0};return P.value.forEach(e=>{a.total++,e.sentiment?a[e.sentiment]++:a.neutral++}),a}),T=u(()=>{if(!c.value)return null;const a=M.value,e=n=>a.total>0?Math.round(n/a.total*100):0;return{totalMentions:a.total,positiveSentiment:e(a.positive),negativeSentiment:e(a.negative),neutralSentiment:e(a.neutral)}}),_="vueleaf_analytics_data",$=9e5,A=6e4;function S(a,e){m.value=a.results||[],c.value=a.all_posts||[],p.value=e||null,h.value=a.graph_data||[],F.value=a.keyword_stats||[],R.value=a.platform_stats||[]}async function b(a){const[e,n]=await Promise.all([f.get("/posts/",{params:a}),f.get("/logs/status/")]);return localStorage.setItem(_,JSON.stringify({data:e.data,status:n.data,timestamp:Date.now(),params:a})),{postsResponse:e,statusResponse:n}}async function D(){w.value=null;const a=t=>{const s=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),d=String(t.getDate()).padStart(2,"0");return`${s}-${o}-${d}`},e={start_date:a(r.value.dateRange.start),end_date:a(r.value.dateRange.end),platforms:r.value.platforms,min_mentions:r.value.minMentions},n=localStorage.getItem(_);if(n){const{data:t,status:s,timestamp:o,params:d}=JSON.parse(n),I=Date.now()-o<$,J=JSON.stringify(e)===JSON.stringify(d);if(I&&J){S(t,s),Date.now()-o>A&&b(e).then(({postsResponse:x,statusResponse:Y})=>{S(x.data,Y.data)}).catch(console.error);return}}y.value=!0;try{const{postsResponse:t,statusResponse:s}=await b(e);S(t.data,s.data)}catch(t){console.error("Error fetching analytics data:",t),w.value="Failed to fetch analytics data",m.value=[],p.value=null}finally{y.value=!1}}async function B(a){try{const e=new Date().getTime(),t=(await f.get(`/brand-ratings/${a}/status/?t=${e}`,{headers:{"Cache-Control":"no-cache",Pragma:"no-cache",Expires:"0"}})).data;switch(t.status){case"error":return i.value="error",v.value=t.message||"Failed to fetch brand rating",t;case"calculating":return i.value="calculating",t.result&&(g.value=t.result),t;case"completed":return t.result&&(i.value="idle",g.value=t.result),t;default:return C(a)}}catch(e){return console.error("Error fetching brand rating:",e),i.value="error",v.value="Failed to fetch brand rating",null}}async function C(a){i.value="calculating",v.value=null;try{const n=(await f.post(`/brand-ratings/${a}/calculate/`,null,{params:{return_status:!0}})).data;switch(n.status){case"error":i.value="error",v.value=n.message||"Failed to calculate brand rating";break;case"completed":n.result&&(i.value="idle",g.value=n.result);break;case"calculating":i.value="calculating",n.result&&(g.value=n.result);break}return n}catch(e){return console.error("Error calculating brand rating:",e),i.value="error",v.value="Failed to calculate brand rating",null}}function N(a){r.value={...r.value,...a},D()}function U(){r.value={dateRange:{start:new Date(new Date().setUTCHours(0,0,0,0)-30*24*60*60*1e3),end:new Date(new Date().setUTCHours(23,59,59,999))},platforms:[],visibleSentiments:{positive:!0,neutral:!0,negative:!0},timeFrame:"90d",minMentions:0,sortBy:"mentions"},D()}return{posts:m,scraperStatus:p,isLoading:y,error:w,filters:r,brandRating:g,brandRatingStatus:i,brandRatingError:v,graphData:h,sentimentOverTime:E,keywordAnalysis:k,platformSummary:H,keywordCorrelation:O,overallStats:T,fetchAnalyticsData:D,fetchBrandRating:B,calculateBrandRating:C,updateFilters:N,resetFilters:U}});export{K as u};
//# sourceMappingURL=analytics-MhD9rDOA.js.map
