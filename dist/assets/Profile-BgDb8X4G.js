import{d as T,H as R,k as i,o as B,c as h,b as e,e as d,a as f,t as P,D as m,ae as p,h as F,bb as _,bc as I,aY as b,bd as y,g as k,aS as z,aM as L,aC as D,ba as Y}from"./main-Dr4KW1PH.js";import{f as H}from"./analytics-green-CyXqBq4X.js";import{U as q}from"./upload-bKZ6ngqV.js";const G={class:"flex-1 p-6"},J={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},K={class:"mb-8 bg-white rounded-lg shadow-sm p-6"},O={class:"flex justify-between items-start"},Q={class:"w-48 h-48 flex-shrink-0 relative"},W=["src"],X={class:"bg-white shadow-lg rounded-lg overflow-hidden mb-8"},Z={class:"p-6"},$={class:"flex items-center space-x-6"},ee={class:"relative w-24 h-24"},ae=["src","alt"],se={key:1,class:"w-24 h-24 rounded-full bg-gray-100 border-4 border-green-200 flex items-center justify-center"},re={for:"avatar-upload",class:"absolute bottom-0 right-0 bg-white rounded-full p-2 shadow-lg cursor-pointer hover:bg-gray-50"},te={class:"text-xl font-semibold text-gray-900 mb-2"},oe={class:"mt-6 space-y-4"},le=["disabled"],ne={class:"bg-white shadow-lg rounded-lg overflow-hidden"},de={class:"p-6"},ie={class:"flex items-center gap-3 mb-6"},ue={class:"flex items-center justify-center w-10 h-10 rounded-lg bg-emerald-50"},ce={class:"space-y-4"},fe=["disabled"],we=T({__name:"Profile",setup(me){const l=Y(),n=R(),t=i({name:"",email:"",avatar:n.avatar}),u=i(!1),o=i({currentPassword:"",newPassword:"",confirmPassword:""}),v=i(null),g=i(!1),w=i(!1),x=i(null),U=new Set,V=()=>{if(!x.value)return;const s=x.value.src;if(!U.has(s)){U.add(s);const a={attemptedSrc:s,originalAvatar:t.value.avatar,authStoreAvatar:n.avatar,constructedUrl:_(t.value.avatar||n.avatar),apiUrl:"https://vueleaf.com/api",userId:n.username,mediaPath:s.includes("media/avatars/")?"media path found":"no media path"};I("Avatar failed to load",{level:"warning",extra:{...a,fallbackApplied:!0}}),console.error("Avatar load failed:",a),l.error("Failed to load avatar image"),u.value=!0}},N=async()=>{try{const s=await b.get("/users/profile/");t.value=s.data,u.value=!1}catch(s){y(s,{extra:{context:"Profile load failed",username:n.username}}),l.error("Failed to load profile")}},j=async s=>{const a=s.target;if(a.files&&a.files[0]){const r=a.files[0],A=new FileReader;A.onload=c=>{var C;v.value=(C=c.target)==null?void 0:C.result,u.value=!1},A.readAsDataURL(r);const S=new FormData;S.append("avatar",r);try{const c=await b.post("/users/upload_avatar/",S,{headers:{"Content-Type":"multipart/form-data"}});l.success("Avatar updated successfully"),n.updateAvatar(c.data.avatar_url)}catch(c){y(c,{extra:{context:"Avatar upload failed",username:n.username,fileSize:r.size,fileType:r.type}}),l.error("Failed to update avatar"),v.value=null,u.value=!0}}},E=async()=>{g.value=!0;try{await b.put("/users/update_profile/",{name:t.value.name,email:t.value.email}),l.success("Profile updated successfully")}catch(s){y(s,{extra:{context:"Profile update failed",username:n.username}}),l.error("Failed to update profile")}finally{g.value=!1}},M=async()=>{if(!o.value.currentPassword){l.error("Please enter your current password");return}if(o.value.newPassword!==o.value.confirmPassword){l.error("New passwords don't match");return}if(o.value.newPassword.length<8){l.error("Password must be at least 8 characters long");return}w.value=!0;try{await b.post("/users/change_password/",{current_password:o.value.currentPassword,new_password:o.value.newPassword}),l.success("Password changed successfully"),o.value={currentPassword:"",newPassword:"",confirmPassword:""}}catch(s){y(s,{extra:{context:"Password change failed",username:n.username}}),l.error("Failed to change password")}finally{w.value=!1}};return B(N),(s,a)=>(k(),h("div",G,[e("div",J,[e("div",K,[e("div",O,[a[5]||(a[5]=e("div",{class:"flex-1"},[e("h1",{class:"text-xl md:text-2xl font-medium text-green-800 mb-2"}," Profile Settings "),e("p",{class:"text-gray-600 text-lg"}," Manage your account's essential security settings in one convenient place. Update your email address to ensure you never miss important notifications, and maintain your account's security by regularly updating your password. Your account's security is our priority. ")],-1)),e("div",Q,[e("img",{src:d(H),alt:"Profile Settings illustration",class:"w-full h-full object-contain"},null,8,W)])])]),e("div",X,[e("div",Z,[e("div",$,[e("div",ee,[!u.value&&(v.value||t.value.avatar||d(n).avatar)?(k(),h("img",{key:0,src:v.value||d(_)(t.value.avatar)||d(_)(d(n).avatar),alt:t.value.name,class:"w-24 h-24 rounded-full object-cover border-4 border-green-200",onError:V,ref_key:"avatarRef",ref:x},null,40,ae)):(k(),h("div",se,[f(d(z),{class:"w-12 h-12 text-gray-400"})])),e("label",re,[f(d(q),{class:"w-4 h-4 text-gray-600"}),e("input",{id:"avatar-upload",type:"file",accept:"image/*",class:"hidden",onChange:j},null,32)])]),e("div",null,[e("h3",te,P(t.value.name),1),a[6]||(a[6]=e("p",{class:"text-base text-gray-500"},"Click the icon to change your avatar",-1))])]),e("div",oe,[e("div",null,[a[7]||(a[7]=e("label",{for:"name",class:"block text-sm font-medium text-gray-700 mb-1"},"Name",-1)),m(e("input",{id:"name","onUpdate:modelValue":a[0]||(a[0]=r=>t.value.name=r),type:"text",class:"w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-green-500"},null,512),[[p,t.value.name]])]),e("div",null,[a[8]||(a[8]=e("label",{for:"email",class:"block text-sm font-medium text-gray-700 mb-1"},"Email",-1)),m(e("input",{id:"email","onUpdate:modelValue":a[1]||(a[1]=r=>t.value.email=r),type:"email",class:"w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-green-500"},null,512),[[p,t.value.email]])]),e("button",{onClick:E,class:"inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",disabled:g.value},[f(d(L),{class:"w-4 h-4 mr-2"}),F(" "+P(g.value?"Saving...":"Save Profile"),1)],8,le)])])]),e("div",ne,[e("div",de,[e("div",ie,[e("div",ue,[f(d(D),{class:"w-5 h-5 text-emerald-600"})]),a[9]||(a[9]=e("div",null,[e("h2",{class:"text-lg font-medium text-gray-700"},"Change Password"),e("p",{class:"text-base text-gray-500"},"Update your password to keep your account secure.")],-1))]),e("div",ce,[e("div",null,[a[10]||(a[10]=e("label",{for:"current-password",class:"block text-sm font-medium text-gray-700 mb-1"},"Current Password",-1)),m(e("input",{id:"current-password","onUpdate:modelValue":a[2]||(a[2]=r=>o.value.currentPassword=r),type:"password",class:"w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-green-500"},null,512),[[p,o.value.currentPassword]])]),e("div",null,[a[11]||(a[11]=e("label",{for:"new-password",class:"block text-sm font-medium text-gray-700 mb-1"},"New Password",-1)),m(e("input",{id:"new-password","onUpdate:modelValue":a[3]||(a[3]=r=>o.value.newPassword=r),type:"password",class:"w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-green-500"},null,512),[[p,o.value.newPassword]]),a[12]||(a[12]=e("p",{class:"text-sm text-gray-500 mt-1"},"Password must be at least 8 characters long",-1))]),e("div",null,[a[13]||(a[13]=e("label",{for:"confirm-password",class:"block text-sm font-medium text-gray-700 mb-1"},"Confirm New Password",-1)),m(e("input",{id:"confirm-password","onUpdate:modelValue":a[4]||(a[4]=r=>o.value.confirmPassword=r),type:"password",class:"w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-green-500"},null,512),[[p,o.value.confirmPassword]])])]),e("button",{onClick:M,class:"mt-6 inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",disabled:w.value},[f(d(D),{class:"w-4 h-4 mr-2"}),F(" "+P(w.value?"Changing...":"Change Password"),1)],8,fe)])])])]))}});export{we as default};
//# sourceMappingURL=Profile-BgDb8X4G.js.map
