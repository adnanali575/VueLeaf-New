{"version":3,"file":"ActivityLogView-CIepjrbh.js","sources":["../../src/views/admin/ActivityLogView.vue"],"sourcesContent":["<script setup lang=\"ts\">\r\nimport { ref, onMounted, watch, computed } from 'vue'\r\nimport { RefreshCw, Filter, ChevronLeft, ChevronRight } from 'lucide-vue-next'\r\nimport axios from '@/lib/axios'\r\n\r\ninterface Activity {\r\n  id: number\r\n  action_time: string\r\n  user: string\r\n  change_message: string\r\n}\r\n\r\n// Activity data\r\nconst activities = ref<Activity[]>([])\r\nconst loading = ref(false)\r\nconst currentPage = ref(1)\r\nconst totalPages = ref(1)\r\nconst itemsPerPage = 10\r\n\r\n// Filter state\r\nconst filters = ref({\r\n  method: '',\r\n  actionType: '',\r\n  username: '',\r\n  dateRange: {\r\n    start: '',\r\n    end: ''\r\n  }\r\n})\r\n\r\n// Computed total items\r\nconst totalItems = computed(() => {\r\n  return activities.value?.length || 0\r\n})\r\n\r\n// Filter options\r\nconst methodOptions = [\r\n  { value: '', label: 'All Methods' },\r\n  { value: 'GET', label: 'GET' },\r\n  { value: 'POST', label: 'POST' },\r\n  { value: 'PUT', label: 'PUT' },\r\n  { value: 'DELETE', label: 'DELETE' }\r\n]\r\n\r\nconst actionTypeOptions = [\r\n  { value: '', label: 'All Actions' },\r\n  { value: 'keyword', label: 'Keyword Operations' },\r\n  { value: 'profile', label: 'Profile Updates' },\r\n  { value: 'auth', label: 'Authentication' },\r\n  { value: 'system', label: 'System Access' }\r\n]\r\n\r\nfunction clearFilters() {\r\n  filters.value = {\r\n    method: '',\r\n    actionType: '',\r\n    username: '',\r\n    dateRange: {\r\n      start: '',\r\n      end: ''\r\n    }\r\n  }\r\n}\r\n\r\nasync function fetchActivities(page = 1) {\r\n  loading.value = true\r\n  try {\r\n    const response = await axios.get('/admin/log', {\r\n      params: {\r\n        page,\r\n        page_size: itemsPerPage,\r\n        method: filters.value.method,\r\n        action_type: filters.value.actionType,\r\n        username: filters.value.username,\r\n        date_start: filters.value.dateRange.start,\r\n        date_end: filters.value.dateRange.end\r\n      }\r\n    })\r\n    activities.value = response.data.results\r\n    totalPages.value = Math.ceil(response.data.count / itemsPerPage)\r\n    currentPage.value = page\r\n  } catch (error) {\r\n    console.error('Failed to fetch activities:', error)\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\n// Watch filters for changes\r\nwatch(filters, () => {\r\n  fetchActivities(1) // Reset to first page when filters change\r\n}, { deep: true })\r\n\r\nfunction getMethodDetails(message: string): { method: string; details: string } {\r\n  // Extract action type and details\r\n  const actionTypes = {\r\n    'Password change': 'PASSWORD',\r\n    'Profile update': 'PROFILE',\r\n    'Login': 'LOGIN',\r\n    'Logout': 'LOGOUT',\r\n    'Token refresh': 'TOKEN'\r\n  }\r\n\r\n  // Check for specific actions first\r\n  for (const [actionText, actionType] of Object.entries(actionTypes)) {\r\n    if (message.toLowerCase().includes(actionText.toLowerCase())) {\r\n      return {\r\n        method: actionType,\r\n        details: message\r\n      }\r\n    }\r\n  }\r\n\r\n  // If no specific action found, extract HTTP method if present\r\n  const methods = ['GET', 'POST', 'PUT', 'PATCH', 'DELETE']\r\n  for (const m of methods) {\r\n    if (message.includes(m)) {\r\n      return {\r\n        method: m,\r\n        details: message.replace(new RegExp(`^${m}\\\\s+`), '')\r\n      }\r\n    }\r\n  }\r\n\r\n  // Default case\r\n  return {\r\n    method: 'ACTION',\r\n    details: message\r\n  }\r\n}\r\n\r\nfunction getMethodColor(method: string): string {\r\n  const colors = {\r\n    'GET': 'bg-blue-100 text-blue-800',\r\n    'POST': 'bg-green-100 text-green-800',\r\n    'PUT': 'bg-yellow-100 text-yellow-800',\r\n    'PATCH': 'bg-yellow-100 text-yellow-800',\r\n    'DELETE': 'bg-red-100 text-red-800',\r\n    'PASSWORD': 'bg-purple-100 text-purple-800',\r\n    'PROFILE': 'bg-indigo-100 text-indigo-800',\r\n    'LOGIN': 'bg-teal-100 text-teal-800',\r\n    'LOGOUT': 'bg-orange-100 text-orange-800',\r\n    'TOKEN': 'bg-cyan-100 text-cyan-800'\r\n  }\r\n  \r\n  return colors[method] || 'bg-gray-100 text-gray-800'\r\n}\r\n\r\nfunction formatDetails(details: string): string {\r\n  // Split by the separator for user agent and IP\r\n  const mainPart = details.split(' | ')[0]\r\n  \r\n  // Clean up API paths\r\n  if (mainPart.startsWith('/api/')) {\r\n    const parts = mainPart.split('/')\r\n    // Convert /api/logs/available-sources/ to \"Get Available Sources\"\r\n    return parts\r\n      .filter(p => p && p !== 'api')\r\n      .map(p => p.replace(/-/g, ' '))\r\n      .map(p => p.charAt(0).toUpperCase() + p.slice(1))\r\n      .join(' - ')\r\n  }\r\n  \r\n  return mainPart\r\n}\r\n\r\nfunction extractUserAgent(message: string): string {\r\n  const match = message.match(/User Agent: ([^|]+)/)\r\n  return match ? match[1].trim() : 'Unknown'\r\n}\r\n\r\nfunction extractIP(message: string): string {\r\n  const match = message.match(/IP: ([^|]+)/)\r\n  return match ? match[1].trim() : 'Unknown'\r\n}\r\n\r\nonMounted(() => {\r\n  fetchActivities()\r\n})\r\n</script>\r\n\r\n<template>\r\n  <div class=\"flex-1 p-6\">\r\n    <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\r\n      <!-- Header -->\r\n      <div class=\"flex justify-between items-center mb-8\">\r\n        <h1 class=\"text-xl md:text-2xl font-medium text-grey-700\">User Activity Log</h1>\r\n        <button\r\n          @click=\"fetchActivities(currentPage)\"\r\n          class=\"inline-flex items-center px-4 py-2 text-base font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500\"\r\n          :disabled=\"loading\"\r\n        >\r\n          <RefreshCw\r\n            class=\"w-5 h-5 mr-2\"\r\n            :class=\"{ 'animate-spin': loading }\"\r\n          />\r\n          Refresh\r\n        </button>\r\n      </div>\r\n\r\n      <!-- Filters Section -->\r\n      <div class=\"bg-white rounded-lg shadow-sm mb-8\">\r\n        <div class=\"p-4 space-y-4\">\r\n          <div>\r\n            <h2 class=\"text-lg font-medium text-gray-700\">Activity Filters</h2>\r\n            <p class=\"text-base text-gray-500\">\r\n              Filter activities by date range, method, and action type to focus your analysis.\r\n            </p>\r\n          </div>\r\n          <div class=\"grid grid-cols-5 gap-4\">\r\n            <!-- Date Range Start -->\r\n            <div class=\"relative\">\r\n              <input\r\n                v-model=\"filters.dateRange.start\"\r\n                type=\"date\"\r\n                class=\"w-full pl-3 pr-3 py-2 bg-white border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500\"\r\n              />\r\n            </div>\r\n            <!-- Date Range End -->\r\n            <div class=\"relative\">\r\n              <input\r\n                v-model=\"filters.dateRange.end\"\r\n                type=\"date\"\r\n                class=\"w-full pl-3 pr-3 py-2 bg-white border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500\"\r\n              />\r\n            </div>\r\n\r\n            <!-- Username Filter -->\r\n            <div class=\"relative\">\r\n              <Filter class=\"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-500 pointer-events-none\" />\r\n              <input\r\n                v-model=\"filters.username\"\r\n                type=\"text\"\r\n                placeholder=\"Filter by username...\"\r\n                class=\"w-full bg-white border border-gray-300 rounded-md pl-10 pr-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500\"\r\n              />\r\n            </div>\r\n\r\n            <!-- Method Filter -->\r\n            <div class=\"relative\">\r\n              <Filter class=\"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-500 pointer-events-none\" />\r\n              <select\r\n                v-model=\"filters.method\"\r\n                class=\"w-full bg-white border border-gray-300 rounded-md pl-10 pr-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 appearance-none\"\r\n              >\r\n                <option\r\n                  v-for=\"option in methodOptions\"\r\n                  :key=\"option.value\"\r\n                  :value=\"option.value\"\r\n                >\r\n                  {{ option.label }}\r\n                </option>\r\n              </select>\r\n            </div>\r\n\r\n            <!-- Action Type Filter -->\r\n            <div class=\"relative\">\r\n              <Filter class=\"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-500 pointer-events-none\" />\r\n              <select\r\n                v-model=\"filters.actionType\"\r\n                class=\"w-full bg-white border border-gray-300 rounded-md pl-10 pr-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 appearance-none\"\r\n              >\r\n                <option\r\n                  v-for=\"option in actionTypeOptions\"\r\n                  :key=\"option.value\"\r\n                  :value=\"option.value\"\r\n                >\r\n                  {{ option.label }}\r\n                </option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Clear Filters -->\r\n          <div class=\"flex justify-end\">\r\n            <button\r\n              @click=\"clearFilters\"\r\n              class=\"text-sm font-medium text-gray-600 hover:text-gray-900\"\r\n            >\r\n              Clear Filters\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    \r\n      <!-- Table -->\r\n      <div class=\"bg-white rounded-lg shadow overflow-hidden\">\r\n        <div class=\"overflow-x-auto\">\r\n          <table class=\"min-w-full divide-y divide-gray-200\">\r\n            <thead class=\"bg-gray-50\">\r\n              <tr>\r\n                <th class=\"w-48 px-8 py-4 text-left text-base font-medium text-gray-700 uppercase tracking-wider\">Time</th>\r\n                <th class=\"w-40 px-8 py-4 text-left text-base font-medium text-gray-700 uppercase tracking-wider\">User</th>\r\n                <th class=\"w-32 px-8 py-4 text-left text-base font-medium text-gray-700 uppercase tracking-wider\">Method</th>\r\n                <th class=\"px-8 py-4 text-left text-base font-medium text-gray-700 uppercase tracking-wider\">Details</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody class=\"bg-white divide-y divide-gray-200\">\r\n              <template v-if=\"loading && !activities.length\">\r\n                <tr>\r\n                  <td colspan=\"4\" class=\"px-6 py-4 text-center text-base text-gray-600\">\r\n                    <div class=\"flex items-center justify-center space-x-2\">\r\n                      <RefreshCw class=\"w-5 h-5 animate-spin\" />\r\n                      <span>Loading activities...</span>\r\n                    </div>\r\n                  </td>\r\n                </tr>\r\n              </template>\r\n              <template v-else-if=\"!activities.length\">\r\n                <tr>\r\n                  <td colspan=\"4\" class=\"px-6 py-4 text-center text-base text-gray-600\">\r\n                    No activities found\r\n                  </td>\r\n                </tr>\r\n              </template>\r\n              <template v-else>\r\n                <tr v-for=\"activity in activities\" :key=\"activity.id\" class=\"hover:bg-gray-50\">\r\n                  <td class=\"w-48 px-8 py-4 whitespace-nowrap text-base text-gray-600\">\r\n                    {{ new Date(activity.action_time).toLocaleString('en-US', {\r\n                      month: 'short',\r\n                      day: 'numeric',\r\n                      hour: 'numeric',\r\n                      minute: '2-digit',\r\n                      hour12: true\r\n                    }).replace(',', ' -') }}\r\n                  </td>\r\n                  <td class=\"w-40 px-8 py-4 whitespace-nowrap\">\r\n                    <div class=\"text-base font-medium text-gray-700\">\r\n                      {{ activity.user }}\r\n                    </div>\r\n                  </td>\r\n                  <td class=\"w-32 px-8 py-4 whitespace-nowrap\">\r\n                    <span\r\n                      class=\"px-3 py-1 inline-flex text-sm font-normal rounded-md\"\r\n                      :class=\"getMethodColor(getMethodDetails(activity.change_message).method)\"\r\n                    >\r\n                      {{ getMethodDetails(activity.change_message).method }}\r\n                    </span>\r\n                  </td>\r\n                  <td class=\"px-8 py-4\">\r\n                    <div class=\"group relative\">\r\n                      <div class=\"text-base text-gray-600\">\r\n                        {{ formatDetails(getMethodDetails(activity.change_message).details) }}\r\n                      </div>\r\n                      <div class=\"hidden group-hover:block absolute left-0 top-full mt-2 p-3 bg-gray-800 text-white text-sm rounded-lg shadow-lg z-10 w-96\">\r\n                        <div class=\"space-y-1\">\r\n                          <div><span class=\"font-medium\">User Agent:</span> {{ extractUserAgent(activity.change_message) }}</div>\r\n                          <div><span class=\"font-medium\">IP:</span> {{ extractIP(activity.change_message) }}</div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </td>\r\n                </tr>\r\n              </template>\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n\r\n        <!-- Pagination -->\r\n        <div class=\"border-t border-gray-200 px-4 py-3 flex items-center justify-between\">\r\n          <span class=\"text-sm text-gray-500\">\r\n            Showing {{ activities.length }} of {{ totalItems }} activities\r\n          </span>\r\n          <div class=\"flex items-center gap-2\">\r\n            <button\r\n              class=\"p-1 rounded\"\r\n              :disabled=\"currentPage === 1\"\r\n              @click=\"fetchActivities(currentPage - 1)\"\r\n            >\r\n              <ChevronLeft\r\n                class=\"w-5 h-5\"\r\n                :class=\"currentPage === 1 ? 'text-gray-400' : 'text-gray-600'\"\r\n              />\r\n            </button>\r\n            <span class=\"text-sm text-gray-600\">Page {{ currentPage }} of {{ totalPages }}</span>\r\n            <button\r\n              class=\"p-1 rounded\"\r\n              :disabled=\"currentPage === totalPages\"\r\n              @click=\"fetchActivities(currentPage + 1)\"\r\n            >\r\n              <ChevronRight\r\n                class=\"w-5 h-5\"\r\n                :class=\"currentPage === totalPages ? 'text-gray-400' : 'text-gray-600'\"\r\n              />\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>"],"names":["itemsPerPage","activities","ref","loading","currentPage","totalPages","filters","totalItems","computed","_a","methodOptions","actionTypeOptions","clearFilters","fetchActivities","page","response","axios","error","watch","getMethodDetails","message","actionTypes","actionText","actionType","methods","m","getMethodColor","method","formatDetails","details","mainPart","p","extractUserAgent","match","extractIP","onMounted"],"mappings":"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"}